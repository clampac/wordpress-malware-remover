# WordPress Malware Remover

This project provides scripts to help restore WordPress sites affected by malware, allowing users to perform removal procedures such as installing Wordfence and scanning.

## Directory Structure

- `your-installation-directory/`
  - `wordpress/` (directory where you copy the new installation of WordPress)
  - `logs/` (directory where logs are stored)
  - `downloads/` (directory where WordPress versions are downloaded)
  - `backups/` (directory where backups are stored)
  - `fix_permissions.py` (fixes permissions of files and directories)
  - `manage_database.py` (manages database users and permissions)
  - `replace_wordpress.py` (replaces WordPress directories)
  - `update_wordpress.py` (updates WordPress to a specified version)
  - `backup.py` (performs backups of databases and files)
  - `utils.py` (utility functions, such as password generation, logging, etc.)
  - `main.py` (main script to orchestrate the execution of other scripts)
  - `requirements.txt` (Python dependencies)
  - `config.ini` (configuration file)
  - `README.md` (this file)
  - `.gitignore` (files and directories to be ignored by Git)

## Installation

1. Create a new repository on GitHub and clone it to your local machine:
   ```bash
   git clone https://github.com/clampac/wordpress-malware-remover.git
   ```

2. Copy all project files to the cloned repository directory on your local machine.

3. Navigate to the repository directory and add the files to the repository:
   ```bash
   cd wordpress-malware-remover
   git add .
   git commit -m "Initial commit"
   ```

4. Push the changes to GitHub:
   ```bash
   git push origin main
   ```

5. On your server, connect using PuTTY and install Git if not already installed:
   ```bash
   sudo apt-get update
   sudo apt-get install git
   ```

6. Clone the repository on your server:
   ```bash
   cd /opt
   git clone https://github.com/clampac/wordpress-malware-remover.git
   cd wordpress-malware-remover
   ```

7. Create the necessary directory structure:
   ```bash
   sudo mkdir -p /opt/wordpress-malware-remover/{wordpress,logs,downloads,backups}
   ```

8. Install Python dependencies:
   ```bash
   sudo apt-get update
   sudo apt-get install python3-pip -y
   sudo pip3 install -r /opt/wordpress-malware-remover/requirements.txt
   ```

9. Create a shell script to run the main Python script from any directory:
   ```bash
   sudo touch /usr/local/bin/wordpress-malware-remover.sh
   sudo chmod +x /usr/local/bin/wordpress-malware-remover.sh
   echo #!/bin/bash
   python3 /opt/wordpress-malware-remover/main.py "$@" | sudo tee /usr/local/bin/wordpress-malware-remover.sh
   ```

## Usage

To run the maintenance scripts, use the following command:
```bash
wordpress-malware-remover.sh
```

### Flags

- `--update-wordpress`: Lists the latest 5 versions of WordPress available for download. Allows the user to choose a version and a language to download. Downloads and installs the chosen version in the `wordpress/` directory.
- `-a`: Executes the maintenance procedure for all sites.

### Direct Execution

To execute the `main.py` script directly and pass the `--update-wordpress` flag:
```bash
python3 /opt/wordpress-malware-remover/main.py --update-wordpress
```

To execute the `main.py` script directly and pass the `-a` flag:
```bash
python3 /opt/wordpress-malware-remover/main.py -a
```

## Scripts Overview

- `fix_permissions.py`: Fixes permissions for files and directories in the `htdocs` directory.
- `manage_database.py`: Manages database users, updates `wp-config.php` with new credentials.
- `replace_wordpress.py`: Replaces the `wp-includes` and `wp-admin` directories with the new version.
- `update_wordpress.py`: Updates WordPress to a specified version.
- `backup.py`: Creates backups of the `htdocs` directory and the database, and logs installed plugins and themes.
- `utils.py`: Contains utility functions for password generation, logging, running commands, and listing plugins and themes.
- `main.py`: Orchestrates the execution of the other scripts.

## Future Improvements

- Add continuous monitoring functionality.
- Integrate with GitHub for version control and collaboration.
