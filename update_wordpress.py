import os
import shutil
import utils

def update_wordpress():
    """Update WordPress by listing available versions and downloading the chosen one."""
    latest_versions = utils.get_latest_wordpress_versions()
    print("Available WordPress versions:")
    for i, version in enumerate(latest_versions):
        print(f"{i + 1}. {version}")

    version_choice = int(input("Enter the number of the version to download: ")) - 1
    selected_version = latest_versions[version_choice]

    languages = ["en_US", "es_ES", "de_DE", "fr_FR", "ja_JP", "ru_RU", "pt_BR"]
    print("Available languages:")
    for i, lang in enumerate(languages):
        print(f"{i + 1}. {lang}")

    language_choice = int(input("Enter the number of the language to download: ")) - 1
    selected_language = languages[language_choice]

    base_dir = os.path.dirname(os.path.abspath(__file__))
    download_path = os.path.join(base_dir, f"downloads/wordpress-{selected_version}-{selected_language}.tar.gz")
    utils.download_wordpress_version(selected_version, selected_language, download_path)

    target_path = os.path.join(base_dir, f"wordpress/{selected_version}-{selected_language}")
    if not os.path.exists(target_path):
        os.makedirs(target_path)

    shutil.unpack_archive(download_path, target_path)

    print(f"WordPress {selected_version} ({selected_language}) downloaded and extracted to {target_path}")

if __name__ == "__main__":
    update_wordpress()
