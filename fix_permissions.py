import os
import utils


def fix_permissions(site_name, wp_install_dir):
	"""Fix permissions for files and directories in the WordPress installation."""
	utils.log_action(site_name, "Fixing permissions for files and directories.")
	
	total_items = sum([len(dirs) + len(files) for _, dirs, files in os.walk(wp_install_dir)])
	processed_items = 0
	
	# Set permissions for directories
	for root, dirs, files in os.walk(wp_install_dir):
		for dir_name in dirs:
			dir_path = os.path.join(root, dir_name)
			os.chmod(dir_path, 0o755)
			processed_items += 1
			utils.progress_bar(total_items, processed_items)
	
	# Set permissions for files
	for root, dirs, files in os.walk(wp_install_dir):
		for file_name in files:
			file_path = os.path.join(root, file_name)
			os.chmod(file_path, 0o644)
			processed_items += 1
			utils.progress_bar(total_items, processed_items)
	
	utils.log_action(site_name, "Permissions fixed for all files and directories in the WordPress installation.")
	print()  # Move to the next line after the progress bar is complete


if __name__ == "__main__":
	import sys
	
	site_name = sys.argv[1]
	wp_install_dir = sys.argv[2]
	fix_permissions(site_name, wp_install_dir)
